---
// src/pages/search.astro
import { SITE_TITLE } from '../consts';
import Layout from '../layouts/Layout.astro';
import Card from '../components/Card.astro';
import { getCollection } from 'astro:content'; // Impor getCollection

const query = Astro.url.searchParams.get('query');

// Gunakan getCollection untuk memuat HANYA postingan dari koleksi 'blog'
const allPosts = await getCollection('blog');

let results = [];

if (query) {
  const lowerQuery = query.trim().toLowerCase();

  results = allPosts.filter(post => {
    // Akses data langsung dari post.data (frontmatter) dan post.body (konten mentah)
    const title = (post.data.title || '').toLowerCase();
    const description = (post.data.description || '').toLowerCase();
    const content = (post.body || '').toLowerCase(); // Konten Markdown mentah

    return (
      title.includes(lowerQuery) ||
      description.includes(lowerQuery) ||
      content.includes(lowerQuery)
    );
  });
}
---

<Layout title={query ? `Search: ${query} - ${SITE_TITLE}` : `Search - ${SITE_TITLE}`}>
  <main>
    <section>
      <h1>{query ? `Hasil Pencarian: "${query}"` : 'Search'}</h1>
      {query ? (
          results.length === 0 ? (
            <p>Tidak ada hasil yang ditemukan untuk "{query}".</p>
          ) : (
            <ul class="post-list">
              {results.map((post) => (
                // Perhatikan, kita sekarang menggunakan post.data dan post.slug
                <Card frontmatter={post.data} url={`/blog/${post.id}/`} />
              ))}
            </ul>
          )
        ) : (
          <p>Masukkan kata kunci untuk mencari.</p>
        )
      }
    </section>
  </main>
</Layout>

