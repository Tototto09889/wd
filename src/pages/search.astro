---
// src/pages/search.astro
import { SITE_TITLE } from '../consts';
import Layout from '../layouts/Layout.astro';
import Card from '../components/Card.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog');

function createPostUrl(post) {
    return `/blog/${post.id}/`;
}

// Hapus bagian ini, karena kita tidak lagi mengambil query dari URL
// const query = Astro.url.searchParams.get('query');
// let searchTerm = '';
// if (query) {
//   searchTerm = query.trim().toLowerCase();
// }
---

<Layout title={`Search - ${SITE_TITLE}`}>
  <main>
    <section>
      <h1>Search</h1>
      <div class="search-container">
        {/* Hapus value={searchTerm} */}
        <input type="text" id="search-input" placeholder="Cari..."  />
      </div>
      <ul class="post-list">
        {allPosts.map((post) => (
          <Card frontmatter={post.data} url={createPostUrl(post)} />
        ))}
      </ul>
        <p id="no-results" style="display: none">Tidak ada hasil yang ditemukan.</p>
    </section>
  </main>
</Layout>

<script>
  const searchInput = document.getElementById('search-input');
  const postList = document.querySelector('.post-list');
  const cards = document.querySelectorAll('.card');
    const noResultsMessage = document.getElementById('no-results');

  searchInput.addEventListener('input', () => {
    const searchTerm = searchInput.value.trim().toLowerCase();
    let visibleCount = 0;

    cards.forEach(card => {
      const title = card.querySelector('h2')?.textContent.toLowerCase() || '';
      const description = card.querySelector('p')?.textContent.toLowerCase() || '';

      if (title.includes(searchTerm) || description.includes(searchTerm)) {
        card.style.display = 'block';
        visibleCount++;
      } else {
        card.style.display = 'none';
      }
    });
        noResultsMessage.style.display = visibleCount === 0 ? "block" : "none";
  });
</script>

<style>
/* ... (CSS kamu) ... */
</style>
