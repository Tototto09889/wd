---
// src/pages/search.astro
import { SITE_TITLE } from '../consts';
import Layout from '../layouts/Layout.astro';
import Card from '../components/Card.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog');

function createPostUrl(post) {
    return `/blog/${post.id}/`;
}
---
<Layout title={`Search - ${SITE_TITLE}`}>
<main>
    <section>
    <h1>Search</h1>
    <div class="search-container">
        <input type="text" id="search-input" placeholder="Cari..." />
    </div>
    <ul class="post-list">
        {allPosts.map((post) => (
        <Card frontmatter={post.data} url={createPostUrl(post)} />
        ))}
    </ul>
    <p id="no-results" style="display: none;">Tidak ada hasil yang ditemukan.</p>
    </section>
</main>
</Layout>
<script>
  const searchInput = document.getElementById('search-input');
  const postList = document.querySelector('.post-list'); // Hanya satu ul
  const cards = document.querySelectorAll('.card'); // Semua elemen card
  const noResultsMessage = document.getElementById('no-results');

  searchInput.addEventListener('input', () => {
    const searchTerm = searchInput.value.trim().toLowerCase();
     let visibleCount = 0;

    cards.forEach(card => {
      const title = card.querySelector('h2')?.textContent.toLowerCase() || '';
      const description = card.querySelector('p')?.textContent.toLowerCase() || '';

      if ((title.includes(searchTerm) || description.includes(searchTerm)) && visibleCount < 3) {
        card.style.display = 'block'; // atau 'flex', tergantung layout kamu
        visibleCount++;
      } else {
        card.style.display = 'none';
      }
    });
     noResultsMessage.style.display = visibleCount === 0 ? "block" : "none";
  });
</script>

<style>
  .post-list {
    list-style: none;
    padding: 0;
  }
  .search-container {
    margin-bottom: 1rem;
  }
  .search-container input {
        padding: 0.5rem;
        border: 1px solid #ccc;
        border-radius: 4px;
        width: 100%;
        max-width: 400px;
    }
  /* Tambahkan styling lain jika diperlukan di sini */
</style>
