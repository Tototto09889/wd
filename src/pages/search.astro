---
// src/pages/search.astro
import { SITE_TITLE } from '../consts';
import Layout from '../layouts/Layout.astro'; // Pastikan path ini benar!
import Header from '../components/Header.astro'; // Pastikan path ini benar!
import Footer from '../components/Footer.astro'; // Pastikan path ini benar!
import BaseHead from '../components/BaseHead.astro'; // Pastikan path ini benar!
import Card from '../components/Card.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog');
const query = Astro.url.searchParams.get('query'); // Ambil query dari URL

function createPostUrl(post) {
    return `/blog/${post.id}/`;
}

let searchTerm = ''; // Variabel untuk menyimpan kata kunci pencarian
if (query) {
  searchTerm = query.trim().toLowerCase(); // Simpan query jika ada
}
---

<Layout title={`Search - ${SITE_TITLE}`}>
    <BaseHead title={query ? `Hasil Pencarian: "${query}" - ${SITE_TITLE}`: `Search - ${SITE_TITLE}`} description={"Search Page"} />
  <Header /> {/* Pastikan komponen ini ada! */}
  <main>
    <section>
      <h1>Search</h1>
      <div class="search-container">
        {/* Set value input ke searchTerm */}
        <input type="text" id="search-input" placeholder="Cari..." value={searchTerm} />
      </div>
      <ul class="post-list">
        {allPosts.map((post) => (
          <Card frontmatter={post.data} url={createPostUrl(post)} />
        ))}
      </ul>
        <p id="no-results" style=`display: ${allPosts.filter(post => {
            const title = (post.data.title || '').toLowerCase();
            const description = (post.data.description || '').toLowerCase();
            return title.includes(searchTerm) || description.includes(searchTerm);
        }).length === 0 && searchTerm !== '' ? 'block' : 'none'};`>
            Tidak ada hasil yang ditemukan.
        </p>
    </section>
  </main>
  <Footer /> {/* Pastikan komponen ini ada! */}
</Layout>

<script>
  const searchInput = document.getElementById('search-input');
  const postList = document.querySelector('.post-list');
  const cards = document.querySelectorAll('.card');
    const noResultsMessage = document.getElementById('no-results');

  searchInput.addEventListener('input', () => {
    const searchTerm = searchInput.value.trim().toLowerCase();
    let visibleCount = 0;

    cards.forEach(card => {
      const title = card.querySelector('h2')?.textContent.toLowerCase() || '';
      const description = card.querySelector('p')?.textContent.toLowerCase() || '';

      if (title.includes(searchTerm) || description.includes(searchTerm)) {
        card.style.display = 'block';
        visibleCount++;
      } else {
        card.style.display = 'none';
      }
    });
        noResultsMessage.style.display = visibleCount === 0 ? "block" : "none";
  });

//   // Opsional: Jika ingin otomatis melakukan pencarian saat halaman dimuat dengan query
//   if (searchTerm) {
//     searchInput.dispatchEvent(new Event('input')); // Picu event 'input'
//   }
</script>
<style>
/* ... (CSS kamu) ... */
</style>
